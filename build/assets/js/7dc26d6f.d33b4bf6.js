"use strict";(globalThis.webpackChunkmydocs=globalThis.webpackChunkmydocs||[]).push([[791],{8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},9113:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Foundations/request-lifecycle","title":"Request Lifecycle","description":"Purpose","source":"@site/docs/Foundations/request-lifecycle.md","sourceDirName":"Foundations","slug":"/Foundations/request-lifecycle","permalink":"/brs-rmm-ai-documentation/docs/Foundations/request-lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Foundations/request-lifecycle.md","tags":[{"inline":true,"label":"request-lifecycle","permalink":"/brs-rmm-ai-documentation/docs/tags/request-lifecycle"},{"inline":true,"label":"http-flow","permalink":"/brs-rmm-ai-documentation/docs/tags/http-flow"},{"inline":true,"label":"middleware","permalink":"/brs-rmm-ai-documentation/docs/tags/middleware"},{"inline":true,"label":"controllers","permalink":"/brs-rmm-ai-documentation/docs/tags/controllers"},{"inline":true,"label":"processing","permalink":"/brs-rmm-ai-documentation/docs/tags/processing"}],"version":"current","lastUpdatedBy":"Hair","lastUpdatedAt":1761836475000,"frontMatter":{"status":"draft","lastReviewed":"2025-10-08T00:00:00.000Z","owner":"members-module-team","category":"foundations","tags":["request-lifecycle","http-flow","middleware","controllers","processing"]},"sidebar":"foundationsSidebar","previous":{"title":"Multi-Tenancy","permalink":"/brs-rmm-ai-documentation/docs/Foundations/multi-tenancy"},"next":{"title":"Security Overview","permalink":"/brs-rmm-ai-documentation/docs/Foundations/security-overview"}}');var r=i(4848),l=i(8453);const t={status:"draft",lastReviewed:new Date("2025-10-08T00:00:00.000Z"),owner:"members-module-team",category:"foundations",tags:["request-lifecycle","http-flow","middleware","controllers","processing"]},o="Request Lifecycle",a={},c=[{value:"Purpose",id:"purpose",level:2},{value:"When You Need This",id:"when-you-need-this",level:2},{value:"Context / Diagram",id:"context--diagram",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Flow / Sequence",id:"flow--sequence",level:2},{value:"Rules &amp; Constraints",id:"rules--constraints",level:2},{value:"Minimal Example",id:"minimal-example",level:2},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"request-lifecycle",children:"Request Lifecycle"})}),"\n",(0,r.jsx)(n.h2,{id:"purpose",children:"Purpose"}),"\n",(0,r.jsx)(n.p,{children:"Describe the end\u2011to\u2011end journey of an inbound HTTP request through controllers, command bus, handlers, repositories, caching, and response rendering under strict club scope."}),"\n",(0,r.jsx)(n.h2,{id:"when-you-need-this",children:"When You Need This"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Debugging latency or unexpected data"}),"\n",(0,r.jsx)(n.li,{children:"Adding a new endpoint or controller action"}),"\n",(0,r.jsx)(n.li,{children:"Tracing where to inject validation or transformation"}),"\n",(0,r.jsx)(n.li,{children:"Performing performance or resilience reviews"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"context--diagram",children:"Context / Diagram"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"HTTP Request\n   \u2193 (Routing)\nController \u2192 Build Command \u2192 Dispatch\n                 \u2193\n           Command Bus \u2192 Handler\n                              \u2193\n                        Repository \u2192 Redis Cache (check)\n                              \u2193 (miss)\n                           BRS API (HTTP)\n                              \u2193\n                        Value Objects\n                              \u2193\n                        View Model / JSON\n                              \u2193\n                          HTTP Response\n"})}),"\n",(0,r.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Thin Controller: Parameter extraction + command dispatch only"}),"\n",(0,r.jsx)(n.li,{children:"Command Bus: Central dispatch enabling cross-cutting middleware (logging, timing)"}),"\n",(0,r.jsx)(n.li,{children:"Handler Isolation: Business coordination, no transport or presentation logic"}),"\n",(0,r.jsx)(n.li,{children:"Repository Boundary: External API access + caching + mapping"}),"\n",(0,r.jsx)(n.li,{children:"Club Context Propagation: Flows from session to every repository call"}),"\n",(0,r.jsx)(n.li,{children:"Idempotent Reads: Safe to retry fetch operations when timeouts occur"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"flow--sequence",children:"Flow / Sequence"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Routing matches path & method \u2192 designated Controller"}),"\n",(0,r.jsx)(n.li,{children:"Controller derives club context from session (fail \u2192 early 4xx)"}),"\n",(0,r.jsx)(n.li,{children:"Controller validates minimal surface (presence of required params)"}),"\n",(0,r.jsx)(n.li,{children:"Controller instantiates Command (pure data) and dispatches"}),"\n",(0,r.jsx)(n.li,{children:"Command Bus invokes Handler (optionally via middleware stack)"}),"\n",(0,r.jsx)(n.li,{children:"Handler orchestrates one or more Repositories (read/update external state)"}),"\n",(0,r.jsx)(n.li,{children:"Redis cache consulted before each API fetch; misses cause outbound HTTP"}),"\n",(0,r.jsx)(n.li,{children:"API responses mapped into Value Objects (immutable)"}),"\n",(0,r.jsx)(n.li,{children:"Handler returns domain result or View Model DTO"}),"\n",(0,r.jsx)(n.li,{children:"Controller serializes (Twig/JSON) and sets status & headers"}),"\n",(0,r.jsx)(n.li,{children:"Frontend scripts may emit DOM events to update live components"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"rules--constraints",children:"Rules & Constraints"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Controllers MUST NOT call repositories directly"}),"\n",(0,r.jsx)(n.li,{children:"Handlers MUST validate club context presence before repository interaction"}),"\n",(0,r.jsx)(n.li,{children:"All repository calls MUST include explicit club identifier parameter"}),"\n",(0,r.jsx)(n.li,{children:"Command Bus middleware SHOULD remain side-effect free (logging/metrics allowed)"}),"\n",(0,r.jsx)(n.li,{children:"Responses MUST avoid leaking raw API payloads; use View Models or Value Objects"}),"\n",(0,r.jsx)(n.li,{children:"Errors SHOULD be converted to standardized problem responses (see Error & Resilience)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"minimal-example",children:"Minimal Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// Controller (simplified)\n$cmd = new GetMemberProfileCommand($clubId, $memberId);\n$profileVO = $commandBus->handle($cmd);\nreturn $this->json(['member' => $profileVO->toArray()]);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Performing heavy validation inside Controllers instead of Handler layer"}),"\n",(0,r.jsx)(n.li,{children:"Swallowing repository exceptions without mapping to domain errors"}),"\n",(0,r.jsx)(n.li,{children:"Returning raw associative arrays instead of Value Objects"}),"\n",(0,r.jsx)(n.li,{children:"Forgetting to pass club scope causing cross-club data exposure risk"}),"\n",(0,r.jsx)(n.li,{children:"Coupling Controller tests to repository behavior (test via command bus)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/brs-rmm-ai-documentation/docs/Foundations/system-architecture",children:"System Architecture"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/brs-rmm-ai-documentation/docs/Foundations/multi-tenancy",children:"Multi-Tenancy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/brs-rmm-ai-documentation/docs/Patterns/commands-and-handlers",children:"Commands & Handlers"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);